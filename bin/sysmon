#!/data/data/com.termux/files/usr/bin/bash
# launcher para sysmon

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
echo $DIR
cd "$DIR"

VENV="$DIR/.venv"
REQS="$DIR/requirements.txt"
PYBIN="$VENV/bin/python"

# 1. Se o venv não existir, cria
if [ ! -d "$VENV" ]; then
    echo "[sysmon] Nenhum venv encontrado, criando em $VENV..."
    python3 -m venv "$VENV"
    source "$VENV/bin/activate"
    
    # 2. Se existir requirements.txt, instala
    if [ -f "$REQS" ]; then
        echo "[sysmon] Instalando dependências..."
        pip install -r "$REQS"
    else
        echo "[sysmon] Nenhum requirements.txt encontrado, seguindo sem deps extras..."
    fi
else
    # 3. Ativa venv existente
    source "$VENV/bin/activate"
fi

# 4. Executa o daemon em background
nohup "$PYBIN" -m sysmon.main > sysmon.log 2>&1 &
echo "sysmon started (logs em sysmon.log)"

